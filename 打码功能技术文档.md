# æ‰“ç åŠŸèƒ½æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [è‡ªåŠ¨æ‰“ç åŸç†](#è‡ªåŠ¨æ‰“ç åŸç†)
4. [æ‰‹åŠ¨æ‰“ç åŸç†](#æ‰‹åŠ¨æ‰“ç åŸç†)
5. [é©¬èµ›å…‹ç®—æ³•è¯¦è§£](#é©¬èµ›å…‹ç®—æ³•è¯¦è§£)
6. [è°ƒè¯•æŒ‡å—](#è°ƒè¯•æŒ‡å—)

---

## é¡¹ç›®æ¦‚è¿°

**dama** æ˜¯ä¸€ä¸ª iOS ç¦»çº¿å›¾ç‰‡æ‰“ç åº”ç”¨ï¼Œæ”¯æŒè‡ªåŠ¨æ£€æµ‹æ•æ„Ÿä¿¡æ¯å¹¶æ‰“ç ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨æ¡†é€‰åŒºåŸŸæ‰“ç ã€‚

### ä¸»è¦åŠŸèƒ½
- âœ… è‡ªåŠ¨æ£€æµ‹æ–‡æœ¬åŒºåŸŸå¹¶æ‰“ç ï¼ˆåŸºäº OCRï¼‰
- âœ… æ‰‹åŠ¨æ¡†é€‰åŒºåŸŸæ‰“ç 
- âœ… å–æ¶ˆæ‰“ç åŠŸèƒ½
- âœ… æ”¯æŒæ‰¹é‡å¤„ç†å¤šå¼ å›¾ç‰‡ï¼ˆæœ€å¤š5å¼ ï¼‰

---

## æ ¸å¿ƒæ¶æ„

### æ–‡ä»¶ç»“æ„
```
dama/
â”œâ”€â”€ ContentView.swift          # ä¸»ç•Œé¢ï¼šå›¾ç‰‡å±•ç¤ºã€å·¥å…·æŒ‰é’®
â”œâ”€â”€ ImageEditorView.swift      # ç¼–è¾‘ç•Œé¢ï¼šæ‰‹åŠ¨æ¡†é€‰ã€åŒºåŸŸç®¡ç†
â””â”€â”€ MosaicProcessor.swift      # æ ¸å¿ƒå¤„ç†å™¨ï¼šé©¬èµ›å…‹ç®—æ³•ã€æ–‡æœ¬æ£€æµ‹
```

### æ•°æ®æµè½¬å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ContentView        â”‚
â”‚  - å›¾ç‰‡åˆ—è¡¨ç®¡ç†      â”‚
â”‚  - å·¥å…·æŒ‰é’®æ§åˆ¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º è‡ªåŠ¨æ‰“ç  â”€â”€â”€â”€â”€â”€â”
       â”‚                       â”‚
       â””â”€â”€â”€â”€â”€â”€â–º æ‰‹åŠ¨æ‰“ç  â”€â”€â”€â”€â”€â”€â”¤
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ MosaicProcessor  â”‚
                    â”‚ - OCR æ–‡æœ¬æ£€æµ‹   â”‚
                    â”‚ - é©¬èµ›å…‹ç®—æ³•     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¤„ç†åçš„å›¾ç‰‡    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è‡ªåŠ¨æ‰“ç åŸç†

### å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant CV as ContentView
    participant MP as MosaicProcessor
    participant Vision as Visionæ¡†æ¶

    U->>CV: ç‚¹å‡»"è‡ªåŠ¨æ‰“ç "
    CV->>MP: detectSensitiveInfo(image)
    MP->>Vision: è°ƒç”¨æ–‡æœ¬è¯†åˆ«API
    Vision-->>MP: è¿”å›æ–‡æœ¬åŒºåŸŸåæ ‡
    MP-->>CV: è¿”å›æ•æ„ŸåŒºåŸŸåˆ—è¡¨
    CV->>MP: addMosaicRegion(åŒºåŸŸ)
    CV->>MP: applyMosaic(å›¾ç‰‡, åŒºåŸŸ)
    MP-->>CV: è¿”å›æ‰“ç åçš„å›¾ç‰‡
    CV->>U: æ˜¾ç¤ºå¤„ç†ç»“æœ
```

### æ ¸å¿ƒä»£ç ä½ç½®

#### 1. è§¦å‘è‡ªåŠ¨æ‰“ç  (`ContentView.swift:212-248`)
```swift
private func activateAutoMosaic() {
    isAutoMosaicActive = true
    isManualModeActive = false

    // éå†æ‰€æœ‰å›¾ç‰‡
    for (index, image) in loadedImages.enumerated() {
        // è°ƒç”¨æ£€æµ‹
        mosaicProcessor.detectSensitiveInfo(in: image) { regions in
            // æ¸…é™¤æ—§åŒºåŸŸ
            mosaicProcessor.clearAllRegions()

            // æ·»åŠ æ£€æµ‹åˆ°çš„åŒºåŸŸ
            for region in regions {
                mosaicProcessor.addMosaicRegion(region, intensity: .high)
            }

            // åº”ç”¨é©¬èµ›å…‹
            if let processedImage = mosaicProcessor.applyMosaic(to: image, regions: mosaicProcessor.mosaicRegions) {
                self.processedImages[index] = processedImage
            }
        }
    }
}
```

#### 2. æ–‡æœ¬æ£€æµ‹ (`MosaicProcessor.swift:181-225`)
ä½¿ç”¨ Apple çš„ **Vision æ¡†æ¶** è¿›è¡Œ OCR æ–‡æœ¬è¯†åˆ«ï¼š

```swift
func detectText(in image: UIImage, completion: @escaping ([CGRect]) -> Void) {
    let request = VNRecognizeTextRequest { request, error in
        guard let observations = request.results as? [VNRecognizedTextObservation] else {
            completion([])
            return
        }

        // è½¬æ¢åæ ‡ç³»ï¼ˆVisionåæ ‡ç³» â†’ UIKitåæ ‡ç³»ï¼‰
        let textRegions = observations.compactMap { observation -> CGRect? in
            let boundingBox = observation.boundingBox
            return CGRect(
                x: boundingBox.origin.x,
                y: 1 - boundingBox.origin.y - boundingBox.height,
                width: boundingBox.width,
                height: boundingBox.height
            )
        }

        completion(textRegions)
    }

    // é…ç½®è¯†åˆ«å‚æ•°
    request.recognitionLevel = .fast  // å¿«é€Ÿè¯†åˆ«æ¨¡å¼
    request.usesLanguageCorrection = false  // ä¸ä½¿ç”¨è¯­è¨€çº æ­£

    // æ‰§è¡Œè¯†åˆ«
    let handler = VNImageRequestHandler(cgImage: cgImage, options: [:])
    try handler.perform([request])
}
```

### å…³é”®æŠ€æœ¯ç‚¹

| æŠ€æœ¯ | è¯´æ˜ |
|------|------|
| **Vision æ¡†æ¶** | Apple å®˜æ–¹ OCR å¼•æ“ï¼Œæ”¯æŒç¦»çº¿æ–‡æœ¬è¯†åˆ« |
| **åæ ‡ç³»è½¬æ¢** | Vision ä½¿ç”¨å·¦ä¸‹è§’åŸç‚¹ï¼ŒUIKit ä½¿ç”¨å·¦ä¸Šè§’åŸç‚¹ï¼Œéœ€è¦è½¬æ¢ |
| **å¼‚æ­¥å¤„ç†** | æ–‡æœ¬æ£€æµ‹åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå®Œæˆåå›è°ƒä¸»çº¿ç¨‹ |

---

## æ‰‹åŠ¨æ‰“ç åŸç†

### å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant CV as ContentView
    participant IE as ImageEditorView
    participant MP as MosaicProcessor

    U->>CV: ç‚¹å‡»"æ‰‹åŠ¨æ‰“ç "
    CV->>IE: æ‰“å¼€ç¼–è¾‘ç•Œé¢
    U->>IE: æ‰‹æŒ‡æ‹–åŠ¨æ¡†é€‰åŒºåŸŸ
    IE->>IE: DragGesture æ•è·åæ ‡
    IE->>MP: addMosaicRegion(rect)
    IE->>MP: applyMosaic(å›¾ç‰‡, åŒºåŸŸ)
    MP-->>IE: è¿”å›æ‰“ç åçš„å›¾ç‰‡
    IE->>U: å®æ—¶æ˜¾ç¤ºæ‰“ç æ•ˆæœ
```

### æ ¸å¿ƒä»£ç ä½ç½®

#### 1. æ‰‹åŠ¨æ¡†é€‰è¦†ç›–å±‚ (`ImageEditorView.swift:175-235`)

```swift
struct ManualSelectionOverlay: View {
    @Binding var currentSelection: CGRect?
    @Binding var isSelecting: Bool
    @Binding var startPoint: CGPoint

    var body: some View {
        GeometryReader { geometry in
            ZStack {
                // åŠé€æ˜é®ç½©
                Color.black.opacity(0.3)

                // å½“å‰æ¡†é€‰åŒºåŸŸ
                if let selection = currentSelection {
                    Rectangle()
                        .stroke(Color.blue, lineWidth: 2)
                        .background(Color.blue.opacity(0.1))
                        .frame(
                            width: selection.width * geometry.size.width,
                            height: selection.height * geometry.size.height
                        )
                }
            }
            .gesture(
                DragGesture()
                    .onChanged { value in
                        // è®°å½•èµ·ç‚¹
                        if !isSelecting {
                            startPoint = value.startLocation
                            isSelecting = true
                        }

                        // è®¡ç®—çŸ©å½¢åŒºåŸŸï¼ˆå½’ä¸€åŒ–åæ ‡ 0-1ï¼‰
                        let currentPoint = value.location
                        let rect = CGRect(
                            x: min(startPoint.x, currentPoint.x) / geometry.size.width,
                            y: min(startPoint.y, currentPoint.y) / geometry.size.height,
                            width: abs(currentPoint.x - startPoint.x) / geometry.size.width,
                            height: abs(currentPoint.y - startPoint.y) / geometry.size.height
                        )
                        currentSelection = rect
                    }
                    .onEnded { _ in
                        // æ¡†é€‰å®Œæˆï¼Œæ·»åŠ æ‰“ç åŒºåŸŸ
                        if let selection = currentSelection,
                           selection.width > 0.02 && selection.height > 0.02 {
                            onSelectionComplete(selection)
                        }
                        currentSelection = nil
                        isSelecting = false
                    }
            )
        }
    }
}
```

### å…³é”®æŠ€æœ¯ç‚¹

| æŠ€æœ¯ | è¯´æ˜ |
|------|------|
| **SwiftUI DragGesture** | æ•è·æ‰‹åŠ¿æ‹–åŠ¨ï¼Œå®æ—¶è®¡ç®—æ¡†é€‰çŸ©å½¢ |
| **å½’ä¸€åŒ–åæ ‡** | åæ ‡å€¼ä¸º 0-1 èŒƒå›´ï¼Œä¸å›¾ç‰‡å®é™…å°ºå¯¸æ— å…³ |
| **å®æ—¶é¢„è§ˆ** | æ¯æ¬¡åæ ‡å˜åŒ–ç«‹å³åˆ·æ–°ç•Œé¢ï¼Œæä¾›è§†è§‰åé¦ˆ |
| **æœ€å°åŒºåŸŸæ£€æµ‹** | è¿‡æ»¤æ‰å®½é«˜å°äº 2% çš„è¯¯è§¦åŒºåŸŸ |

---

## é©¬èµ›å…‹ç®—æ³•è¯¦è§£

### åƒç´ åŒ–åŸç†

é©¬èµ›å…‹æœ¬è´¨æ˜¯**é™ä½å›¾åƒåˆ†è¾¨ç‡**ï¼Œå°†å¤šä¸ªåƒç´ å—åˆå¹¶ä¸ºä¸€ä¸ªé¢œè‰²ã€‚

```
åŸå§‹å›¾ç‰‡ (é«˜æ¸…)          é©¬èµ›å…‹å›¾ç‰‡ (æ¨¡ç³Š)
â”Œâ”€â”¬â”€â”¬â”€â”¬â”€â”              â”Œâ”€â”€â”€â”¬â”€â”€â”€â”
â”‚Aâ”‚Bâ”‚Câ”‚Dâ”‚              â”‚ E â”‚ F â”‚
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤      â†’       â”‚   â”‚   â”‚
â”‚Eâ”‚Fâ”‚Gâ”‚Hâ”‚              â”œâ”€â”€â”€â”¼â”€â”€â”€â”¤
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¤              â”‚ G â”‚ H â”‚
â”‚Iâ”‚Jâ”‚Kâ”‚Lâ”‚              â”‚   â”‚   â”‚
â””â”€â”´â”€â”´â”€â”´â”€â”˜              â””â”€â”€â”€â”´â”€â”€â”€â”˜

E = avg(A,B,E,F)  # è®¡ç®— 2x2 å—çš„å¹³å‡é¢œè‰²
```

### æ ¸å¿ƒç®—æ³• (`MosaicProcessor.swift:80-114`)

```swift
private func applyMosaicToRegion(context: CGContext, region: MosaicRegion, imageSize: CGSize) {
    let blockSize = 20  // å›ºå®š 20x20 åƒç´ å—ï¼ˆæœ€é«˜æ¨¡ç³Šåº¦ï¼‰

    // è½¬æ¢åæ ‡ç³»ï¼ˆUIKit â†’ CoreGraphicsï¼‰
    let flippedRect = CGRect(
        x: rect.origin.x * imageSize.width,
        y: (1 - rect.origin.y - rect.height) * imageSize.height,
        width: rect.width * imageSize.width,
        height: rect.height * imageSize.height
    )

    // éå†æ¯ä¸ªåƒç´ å—
    for y in stride(from: startY, to: endY, by: blockSize) {
        for x in stride(from: startX, to: endX, by: blockSize) {
            let blockRect = CGRect(x: x, y: y, width: blockSize, height: blockSize)

            // 1. è®¡ç®—è¯¥å—çš„å¹³å‡é¢œè‰²
            if let averageColor = getAverageColor(context: context, rect: blockRect) {
                // 2. ç”¨å¹³å‡é¢œè‰²å¡«å……æ•´ä¸ªå—
                context.setFillColor(averageColor)
                context.fill(blockRect)
            }
        }
    }
}
```

### å¹³å‡é¢œè‰²è®¡ç®— (`MosaicProcessor.swift:116-155`)

```swift
private func getAverageColor(context: CGContext, rect: CGRect) -> CGColor? {
    let pixelData = context.data  // è·å–åƒç´ æ•°æ®

    var totalR = 0, totalG = 0, totalB = 0, totalA = 0
    var pixelCount = 0

    // éå†å—å†…æ‰€æœ‰åƒç´ 
    for y in startY..<endY {
        for x in startX..<endX {
            let pixelIndex = y * bytesPerRow + x * bytesPerPixel
            let pixel = pixelData.assumingMemoryBound(to: UInt8.self)

            totalR += Int(pixel[pixelIndex])      // Red
            totalG += Int(pixel[pixelIndex + 1])  // Green
            totalB += Int(pixel[pixelIndex + 2])  // Blue
            totalA += Int(pixel[pixelIndex + 3])  // Alpha
            pixelCount += 1
        }
    }

    // è®¡ç®—å¹³å‡å€¼
    let avgR = CGFloat(totalR) / CGFloat(pixelCount) / 255.0
    let avgG = CGFloat(totalG) / CGFloat(pixelCount) / 255.0
    let avgB = CGFloat(totalB) / CGFloat(pixelCount) / 255.0
    let avgA = CGFloat(totalA) / CGFloat(pixelCount) / 255.0

    return CGColor(red: avgR, green: avgG, blue: avgB, alpha: avgA)
}
```

### ç®—æ³•æµç¨‹å›¾

```
å¼€å§‹
  â”‚
  â–¼
éå†æ‰“ç åŒºåŸŸ
  â”‚
  â–¼
åˆ’åˆ† 20x20 åƒç´ å—
  â”‚
  â–¼
è®¡ç®—æ¯å—çš„å¹³å‡é¢œè‰²
  â”‚  â”‚
  â”‚  â”œâ”€ ç´¯åŠ æ‰€æœ‰åƒç´ çš„ Rã€Gã€Bã€A å€¼
  â”‚  â””â”€ é™¤ä»¥åƒç´ æ•°å¾—åˆ°å¹³å‡å€¼
  â”‚
  â–¼
ç”¨å¹³å‡é¢œè‰²å¡«å……è¯¥å—
  â”‚
  â–¼
æ‰€æœ‰å—å¤„ç†å®Œæˆï¼Ÿ
  â”‚           â”‚
  å¦          æ˜¯
  â”‚           â”‚
  â”‚           â–¼
  â””â”€â”€â”€â”€â–º   è¿”å›å¤„ç†åçš„å›¾ç‰‡
```

---

## è°ƒè¯•æŒ‡å—

### å¸¸è§é—®é¢˜æ’æŸ¥

#### 1ï¸âƒ£ è‡ªåŠ¨æ‰“ç æ²¡æœ‰æ£€æµ‹åˆ°æ–‡æœ¬

**å¯èƒ½åŸå› ï¼š**
- å›¾ç‰‡åˆ†è¾¨ç‡å¤ªä½
- æ–‡å­—å¤ªå°æˆ–æ¨¡ç³Š
- å…‰ç…§æ¡ä»¶ä¸ä½³

**è°ƒè¯•æ–¹æ³•ï¼š**
```swift
// åœ¨ detectText æ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—
func detectText(in image: UIImage, completion: @escaping ([CGRect]) -> Void) {
    let request = VNRecognizeTextRequest { request, error in
        guard let observations = request.results as? [VNRecognizedTextObservation] else {
            print("âŒ æœªæ£€æµ‹åˆ°æ–‡æœ¬")
            completion([])
            return
        }

        print("âœ… æ£€æµ‹åˆ° \(observations.count) ä¸ªæ–‡æœ¬åŒºåŸŸ")
        for (index, obs) in observations.enumerated() {
            print("åŒºåŸŸ \(index): \(obs.boundingBox)")
        }

        // ... åç»­ä»£ç 
    }
}
```

**è§£å†³æ–¹æ¡ˆï¼š**
- è°ƒæ•´ `recognitionLevel` ä¸º `.accurate`ï¼ˆæ›´æ…¢ä½†æ›´å‡†ç¡®ï¼‰
- å¢å¼ºå›¾ç‰‡å¯¹æ¯”åº¦é¢„å¤„ç†

---

#### 2ï¸âƒ£ æ‰‹åŠ¨æ¡†é€‰åŒºåŸŸä¸å‡†ç¡®

**å¯èƒ½åŸå› ï¼š**
- åæ ‡ç³»è½¬æ¢é”™è¯¯
- å›¾ç‰‡ç¼©æ”¾å¯¼è‡´åæ ‡åç§»

**è°ƒè¯•æ–¹æ³•ï¼š**
```swift
// åœ¨ ManualSelectionOverlay ä¸­æ‰“å°åæ ‡
.onEnded { _ in
    if let selection = currentSelection {
        print("æ¡†é€‰åŒºåŸŸï¼ˆå½’ä¸€åŒ–ï¼‰: \(selection)")
        print("æ¡†é€‰åŒºåŸŸï¼ˆåƒç´ ï¼‰: x=\(selection.x * imageSize.width), y=\(selection.y * imageSize.height)")
    }
}
```

---

#### 3ï¸âƒ£ é©¬èµ›å…‹æ•ˆæœä¸æ˜æ˜¾

**å¯èƒ½åŸå› ï¼š**
- `blockSize` å¤ªå°
- åŒºåŸŸé¢ç§¯å¤ªå°

**è§£å†³æ–¹æ¡ˆï¼š**
```swift
// è°ƒæ•´ MosaicIntensity çš„åƒç´ å—å¤§å°
enum MosaicIntensity: Int, CaseIterable {
    case high = 30  // ä» 20 å¢åŠ åˆ° 30ï¼Œæ›´æ¨¡ç³Š
}
```

---

#### 4ï¸âƒ£ å¤„ç†å¤§å›¾ç‰‡æ—¶å¡é¡¿

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
```swift
// åœ¨åå°çº¿ç¨‹å¤„ç†é©¬èµ›å…‹
DispatchQueue.global(qos: .userInitiated).async {
    if let processedImage = mosaicProcessor.applyMosaic(to: image, regions: regions) {
        DispatchQueue.main.async {
            self.processedImages[index] = processedImage
        }
    }
}
```

---

### è°ƒè¯•å·¥å…·æ¨è

| å·¥å…· | ç”¨é€” |
|------|------|
| **Xcode Instruments** | æ€§èƒ½åˆ†æã€å†…å­˜æ³„æ¼æ£€æµ‹ |
| **po å‘½ä»¤** | åœ¨æ–­ç‚¹å¤„æ‰“å°å˜é‡ `po mosaicRegions` |
| **View Hierarchy Debugger** | æ£€æŸ¥ UI å±‚çº§å’Œå¸ƒå±€ |
| **Simulator Camera** | æ¨¡æ‹Ÿç›¸æœºæ‹æ‘„æµ‹è¯• |

---

### å…³é”®æ–­ç‚¹ä½ç½®

æ¨èåœ¨ä»¥ä¸‹ä½ç½®è®¾ç½®æ–­ç‚¹ï¼š

1. **è‡ªåŠ¨æ£€æµ‹å›è°ƒ**ï¼š`ContentView.swift:225`
   ```swift
   mosaicProcessor.detectSensitiveInfo(in: image) { regions in
       // æ–­ç‚¹ï¼šæ£€æŸ¥æ£€æµ‹åˆ°çš„åŒºåŸŸæ•°é‡
   }
   ```

2. **é©¬èµ›å…‹åº”ç”¨**ï¼š`MosaicProcessor.swift:48`
   ```swift
   func applyMosaic(to image: UIImage, regions: [MosaicRegion]) -> UIImage? {
       // æ–­ç‚¹ï¼šæ£€æŸ¥åŒºåŸŸå‚æ•°
   }
   ```

3. **æ‰‹åŠ¨æ¡†é€‰å®Œæˆ**ï¼š`ImageEditorView.swift:221`
   ```swift
   .onEnded { _ in
       // æ–­ç‚¹ï¼šæ£€æŸ¥æ¡†é€‰åæ ‡
   }
   ```

---

## é™„å½•ï¼šåæ ‡ç³»è½¬æ¢è¯´æ˜

### Vision åæ ‡ç³» vs UIKit åæ ‡ç³»

```
Vision åæ ‡ç³»               UIKit åæ ‡ç³»
(å·¦ä¸‹è§’ä¸ºåŸç‚¹)              (å·¦ä¸Šè§’ä¸ºåŸç‚¹)

  â†‘ y                         â†’ x
  â”‚                           â†“ y
  â”‚    â”Œâ”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”
  â”‚    â”‚     â”‚                â”‚     â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â†’ x
```

### è½¬æ¢å…¬å¼

```swift
// Vision â†’ UIKit
let uiKitY = 1 - visionY - visionHeight

// CoreGraphics (å·¦ä¸‹) â†’ UIKit (å·¦ä¸Š)
let uiKitY = (1 - rect.origin.y - rect.height) * imageSize.height
```

---

## å¿«é€Ÿä¸Šæ‰‹ Checklist

- [ ] ç†è§£ `ContentView`ã€`ImageEditorView`ã€`MosaicProcessor` ä¸‰ä¸ªæ–‡ä»¶çš„èŒè´£
- [ ] æŒæ¡ Vision æ¡†æ¶çš„åŸºæœ¬ç”¨æ³•
- [ ] ç†è§£å½’ä¸€åŒ–åæ ‡ç³»ï¼ˆ0-1 èŒƒå›´ï¼‰
- [ ] ç†Ÿæ‚‰é©¬èµ›å…‹ç®—æ³•çš„åƒç´ å—å¹³å‡é¢œè‰²è®¡ç®—
- [ ] å­¦ä¼šä½¿ç”¨ Xcode è°ƒè¯•å·¥å…·æ’æŸ¥é—®é¢˜
- [ ] äº†è§£ SwiftUI çš„ `@State`ã€`@Binding`ã€`@Published` çŠ¶æ€ç®¡ç†

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025-10-03
**ç»´æŠ¤è€…ï¼š** dama å¼€å‘å›¢é˜Ÿ
